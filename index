<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <title></title>
  <meta name="description" content="">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<!--   <link rel="manifest" href="site.webmanifest"> -->
  
<!--   <link rel="stylesheet" href="css/normalize.css"> -->
<!--   <link rel="stylesheet" href="css/main.css"> -->
  <style>
    .button {
      margin: 1rem 0;
      padding: 0.5rem;
      background: none;
      border: 2px solid #0074D9;
      outline: none;
      border-radius: 6px;
      font-size: 1rem;
      color: #0074D9;
      cursor: pointer;
    }
    .button:disabled {
      cursor: not-allowed;
      opacity: 0.25
    }
    
    .button2 {
      background: none;
      border: none;
      outline: none;
      cursor: pointer;
      color: #0074D9;
      font-weight: bold;
    }
    
    @keyframes spinner { to { transform: rotate(360deg) } }
    .spinner:before {
      content: '';
      display: inline-block;
      box-sizing: border-box;
      min-width: 1rem;
      min-height: 1rem;
      margin-right: 0.5rem;
      border-radius: 50%;
      border-top: 2px solid  #001f3f;
      border-right: 2px solid transparent;
      animation: spinner 1s linear infinite;
    }
  </style>
</head>

<body>
  <h1>Pro2Pup</h1>
  
  Simplify your professional sentences to public!
  <br>
  <input id="input" style="margin: 1rem 0; padding: 0.5rem; font-size:1.5rem" size="60" placeholder="Try: 'Oil the bearings liberally'">
  <button id="randomText" class="button2">Random text</button>
  <span id="charCount" style="display: block; color: #999; margin-top: -0.75rem">Count: 0</span>
  <button id="makeStory" class="button">Simplify</button>
  <span id="spinner" style="opacity:0">May take up to 30 seconds <span class="spinner"></span></span>  
  <div id="output" style="display:none">
    <h3 style="margin-bottom:0.5rem">🐣 Generated fable 🙈</h3>
    <div style="font-size:1.25rem"></div>
    <p style="text-align:center">Now your task is to figure out <b style="font-size:1.25rem">the moral of the story😉</b></p>
    <p style="text-align:center">If you like the story, please share it! ❤️</p>
  </div>
  <div style="margin-top:3rem; color: #333">
    Source code: <a href="https://github.com/manxin0821/InsightData">https://github.com/manxin0821/InsightData</a>
  </div>
  
</body>
<script>
  const input = document.getElementById('input')
  const output = document.getElementById('output')
  const charCount = document.getElementById('charCount')
  const button_makeStory = document.getElementById('makeStory')
  const button_randomText = document.getElementById('randomText')
  const spinner = document.getElementById('spinner')
  button_makeStory.disabled = true
  input.addEventListener('input', function (e) {
    const l = e.currentTarget.value.trim().length
    charCount.textContent = 'Count: ' + l
    button_makeStory.disabled = !l || l > 60
  })
  
  button_randomText.addEventListener('click', function () {
    const suggestions = [
      'Oil the bearings liberally',
    ]
    const index = ~~(Math.random() * suggestions.length)
    input.value = suggestions[index]
    button_makeStory.disabled = false
  })
  button_makeStory.addEventListener('click', function (e) {
    const data = input.value.trim()
    console.log('sending', data)
    button_makeStory.disabled = true
    input.disabled = true
    spinner.style.opacity = 1
    fetch('/predict', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ text_seed: data }),
    }).then(r => r.text())
      .then(r => {
        output.style.display = 'block'
        output.children[1].textContent = r
      })
      .finally(() => {
        button_makeStory.disabled = false
        input.disabled = false
        spinner.style.opacity = 0
      })
  })
</script> 
  
</html>
